<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Recent Results | My WebApp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f5f5;
      padding-top: 40px;
    }
    .container {
      max-width: 800px;
    }
    h2 {
      color: #2c3e50;
      margin-bottom: 30px;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
      text-align: center;
    }
    .run-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      overflow: hidden;
    }
    .run-header {
      background-color: #3498db;
      color: white;
      padding: 10px 15px;
      font-weight: 500;
    }
    .run-body {
      display: flex;
      align-items: center;
      padding: 15px;
    }
    .run-body img {
      max-width: 150px;
      max-height: 150px;
      object-fit: cover;
      border-radius: 4px;
      margin-right: 20px;
    }
    .run-links button {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 5px;
    }
    .btn-back {
      margin-bottom: 20px;
    }
    .no-runs {
      text-align: center;
      color: #666;
      margin-top: 50px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Recent Results</h2>
    <a href="{% url 'home' %}" class="btn btn-outline-primary btn-back">&larr; Back to Home</a>

    {% if runs %}
      {% for run in runs %}
        <div class="run-card">
          <div class="run-header">
            Run: {{ run.run_name }}
          </div>
          <div class="run-body">
            <img src="{{ run.image_url }}" alt="Output image for {{ run.run_name }}">
            <div class="run-links">
              <!-- Image modal trigger -->
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#modalImage{{ forloop.counter }}"
              >
                View Image
              </button>

              <!-- Results modal trigger -->
              <button
                type="button"
                class="btn btn-sm btn-secondary"
                data-bs-toggle="modal"
                data-bs-target="#modalResults{{ forloop.counter }}"
              >
                View Results
              </button>
            </div>
          </div>
        </div>

        <!-- Image Modal -->
        <div
          class="modal fade"
          id="modalImage{{ forloop.counter }}"
          tabindex="-1"
          aria-labelledby="modalImageLabel{{ forloop.counter }}"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalImageLabel{{ forloop.counter }}">
                  Image for {{ run.run_name }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body text-center">
                <img src="{{ run.image_url }}" class="img-fluid" alt="Full-size image">
              </div>
            </div>
          </div>
        </div>

        <!-- Results Modal -->
        <div
          class="modal fade"
          id="modalResults{{ forloop.counter }}"
          tabindex="-1"
          aria-labelledby="modalResultsLabel{{ forloop.counter }}"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalResultsLabel{{ forloop.counter }}">
                  Results for {{ run.run_name }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <ul class="list-unstyled mb-0">
                  <li><strong>Harmonic Cutoff Roughness:</strong> {{ run.results.roughness }}</li>
                  <li><strong>Roundness:</strong> {{ run.results.roundness }}</li>
                  <li><strong>Sphericity:</strong> {{ run.results.sphericity }}</li>
                  <li><strong>Nrq:</strong> {{ run.results.nrq }}</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

      {% endfor %}
    {% else %}
      <p class="no-runs">No recent results to display.</p>
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
